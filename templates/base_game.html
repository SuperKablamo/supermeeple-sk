{% extends "base.html" %}

	{% block title %}{{ game.name }} - Board Game - SuperMeeple{% endblock %}

	{% block facebook_meta %}<meta property="fb:app_id" content="{{facebook_app_id}}"/>
  <meta property="og:title" content="{{game.name}}"/>
  <meta property="og:type" content="game"/>
  <meta property="og:url" content="http://{{host}}/game{{game.key.name}}/{{game.bgg_id}}"/>
  <meta property="og:image" content="{{ game.bgg_img_url }}"/>
  <meta property="og:site_name" content="SuperMeeple"/>	
  <meta property="og:description"
        content="{{ game.description|truncatewords_html:40 }}"/>{% endblock %}	

		{% block main %}
		<div id="mainbar">
			<div id="game-header-wrap">
				<div id="game-header">
					<h1 id="game-title">
						<span class="name">{{ game.name }}</span>
						<span class="year">({{ game.year_published}})</span>
					</h1>
				</div>
				<div id="facebook-like">
					<script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script>
					<fb:like href="http://{{host}}/game{{game.key.name}}/{{game.bgg_id}}" layout="button_count" show_faces="true" width="100" font="arial"></fb:like>				
				</div>
		  </div>
			<div id="game-detail">	
				{% if game.description %}
  			<h2>Overview</h2>
				<div id="description">
					{{ game.description }}
				</div>
				<div id="more-less-container">
					<a href="#" id="more-less">show more >></a>
				</div>	
				<script>
				var open = false;
				$('#more-less').click(function() {
				    if (open) {
				        $('#description').animate({height:'10em'}); 
				        $('#more-less').text('show more >>');				
				    }
				    else {
				        $('#description').animate({height:'100%'});
				 				$('#more-less').text('show less <<');	
				    }
				    open = !open;
				});
				</script>
				{% endif %}

			  {% if game.designers %}
    		<dl>
    			<dt>Designed by</dt>
					{% for x in game.designers %}
					<dd>{{ x }}</dd>
					{% endfor %}
    		</dl>
 				{% endif %}

			  {% if game.artists %}
    		<dl>
    			<dt>Art by</dt>
					{% for x in game.artists %}
					<dd>{{ x }}</dd>
					{% endfor %}
    		</dl>
 				{% endif %}

			  {% if game.publishers %}
    		<dl>
    			<dt>Published by</dt>
					{% for x in game.publishers %}
					<dd>{{ x }}</dd>
					{% endfor %}
    		</dl>
 				{% endif %}

			  {% if game.year_published %}
    		<dl>
    			<dt>Introduced</dt>
					<dd>{{ game.year_published }}</dd>
    		</dl>
 				{% endif %}

     		{% if game.min_players and game.max_players %}
    		<dl>
    			<dt># of players</dt>
					<dd>{{ game.min_players }} - {{ game.max_players }}</dd>
    		</dl>
				{% endif %}

			  {% if game.playing_time %}
    		<dl>
    			<dt>Playing time</dt>
					<dd>{{ game.playing_time }}</dd>
    		</dl>
 				{% endif %}

			  {% if game.age %}
    		<dl>
    			<dt>Ages</dt>
					<dd>{{ game.age }} and up</dd>
    		</dl>
 				{% endif %}

			  {% if game.categories %}
    		<dl>
    			<dt>Tags</dt>
					{% for x in game.categories %}
					<dd>{{ x }}</dd>
					{% endfor %}
    		</dl>
 				{% endif %}

			  {% if game.subdomains %}
    		<dl>
    			<dt>Categories</dt>
					{% for x in game.subdomains %}
					<dd>{{ x }}</dd>
					{% endfor %}
    		</dl>
 				{% endif %}

			  {% if game.mechanics %}
    		<dl>
    			<dt>Mechanics</dt>
					{% for x in game.mechanics %}
					<dd>{{ x }}</dd>
					{% endfor %}
    		</dl>
 				{% endif %}

			  {% if game.expansions %}
    		<dl>
    			<dt>Expansions</dt>
					{% for x in game.expansions %}
					<dd>{{ x }}</dd>
					{% endfor %}
    		</dl>
 				{% endif %}
    		<dl>
    			<dt>Weblinks</dt>
					<dd><a href="http://boardgamegeek.com/boardgame/{{game.bgg_id}}">Board Game Geek</a></dd>
    		</dl>
			</div><!-- /game-detail -->		 
		</div><!-- /main -->	   			
		{% endblock %}		
		
		{% block sidebar %}	
		<div id="sidebar">
			<div class="block">			
    		<div id="search">
     			<form name="input" action="/game" method="post">
         		<input class="search-box" type="text" id="game-search"/>
         		<input type="hidden" name="game_id" id="game-id" />
         		<input type="hidden" name="game_name" id="game-name" />
         		<input class="button" value="Go" type="submit"/>
       		</form>
					<p>search for more games</p>
     		</div>
			</div><!-- /block -->
			<div class="block">
				{% if game.bgg_thumbnail_url %}
  			<div id="game-image">
					<img alt="{{ game.name }}" title="{{ game.name }}" src="{{ game.bgg_thumbnail_url }}"/>
				</div>
				{% endif %}	
			</div>
			<div class="block">
				<div class="tip">
					<p>Playing {{game.name}}?  Game check ins allow you to track plays, scores and wins, and earn badges.</p>
				</div>
				{% if current_user %}
				{% if checked_in %}
				<div id="checkin">
					<h2>You are checked into a game</h2>
					<p>Players must wait 5 minutes before making another check in.</p>
				</div>				
				{% else %}
				<div id="checkin-form">
					<form name="input" action="">
						<fieldset>
							<input type="hidden" name="mid" id="mid" value="{{game.key.name}}"/>
							<input type="hidden" name="bgg-id" id="bgg-id" value="{{game.bgg_id}}"/>
							<input type="hidden" name="name" id="name" value="{{game.name}}"/>
							<input type="hidden" name="thumbnail" id="thumbnail" value="{{ game.bgg_thumbnail_url }}"/>
							<textarea class="text-area" id="message" name="message" rows="3" cols="30">Joining a game of {{ game.name }}.</textarea><br/>
							<p style="text-align:right">Share on <img class="facebook-icon" src="/static/images/facebook-icon-16x16.jpg"/> <input type="checkbox" name="facebook" value="true" checked="checked" id="facebook"/>&nbsp;</p>
							<input type="image" src="/static/images/check-in-button-small.png" style="float:right" name="submit" class="button" id="checkin-button" value="Checkin" />
						</fieldset>
					</form>
				</div>
				{% endif %}
				{% endif %}
			</div><!-- /block -->			
			<div class="block">
				<div class="checkin-list">
					<h2>Recent checkins</h2>
					{% if checkins %}
						{% for c in checkins %}
					<div class="tiny-checkin">
						<p>{{c.created|timesince}} ago</p>
						<div class="player">
					  	<a title="{{c.player.name}}" href="/user/{{c.player.fb_id}}"><img alt="{{c.player.name}}" title="{{c.player.name}}" src="http://graph.facebook.com/{{ c.player.fb_id }}/picture?type=square"/></a><a title="{{c.player.name}}" href="/user/{{c.player.fb_id}}">{{c.player.name}}</a>
						</div>
						<div class="game-badges">
							{% for b in c.badges %}
							<img alt="{{b.name}}" title="{{b.name}}" class="badge" title src="{{b.image_url}}=s20" />
						  {% endfor %}
						</div>						
					</div>
						{% endfor %}
					{% else %}
					<p>No one has checked into {{game.name}} yet. Be the first!
					{% endif %}	
				</div>	
			</div>	
		</div><!-- /sidebar -->	
		{% endblock %}
		